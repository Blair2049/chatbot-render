# RENDER1 - Stakeholder Management Chatbot 项目工作文档

## 📋 项目概述

**项目名称：** Stakeholder Management Chatbot  
**技术栈：** Python Flask + LightRAG + OpenAI API + Render部署  
**项目目标：** 基于利益相关者管理文档的智能问答系统  

---

## 🚀 项目开发历程

### 第一阶段：项目初始化与基础架构

#### 1.1 项目结构搭建
- **LightRAG框架集成**：集成LightRAG检索增强生成框架
- **Flask Web应用**：创建主应用文件 `chatbot_web.py`
- **API端点设计**：实现 `/chat`、`/stats`、`/token_usage` 等核心API
- **环境配置**：设置 `requirements.txt`、`render.yaml` 部署配置

#### 1.2 核心功能实现
- **多模式查询**：支持 Best、Mix、Naive、Local、Global、Hybrid 六种查询模式
- **智能评分系统**：基于完整性、多样性、赋能性三个维度评分
- **成本计算**：实时计算token使用量和API调用成本
- **多语言支持**：自动检测中英文并适配响应

### 第二阶段：Web界面开发

#### 2.1 前端界面设计
- **现代化UI**：采用暗黑主题设计，专业美观
- **响应式布局**：适配桌面和移动设备
- **Tab导航**：Chat和Token Stats两个主要功能模块
- **实时聊天**：支持实时对话，显示评分和成本信息

#### 2.2 交互功能
- **消息历史**：保存和显示对话历史
- **模式选择**：用户可选择不同的查询模式
- **统计显示**：实时显示token使用统计
- **评分反馈**：显示AI回答的质量评分

### 第三阶段：数据可视化与统计

#### 3.1 Token使用跟踪
- **TokenUsageTracker类**：专门用于跟踪token使用情况
- **历史记录存储**：支持内存存储（Render环境）和文件存储（本地环境）
- **成本估算**：基于OpenAI最新费率计算成本
- **多维度统计**：按日期、模型、请求次数等维度统计

#### 3.2 可视化图表
- **柱状图显示**：Daily Token Usage改为柱状图，更直观显示使用量
- **Tooltip功能**：鼠标悬停显示详细信息
- **实时更新**：图表数据实时更新
- **暗黑主题适配**：图表配色与整体主题一致

### 第四阶段：用户体验优化

#### 4.1 界面优化
- **Usage Statistics卡片**：放大优化布局，更清晰显示统计信息
- **历史记录侧边栏**：默认隐藏状态，节省屏幕空间
- **弹窗优化**：历史记录详情弹窗采用深色主题，确保可读性
- **时间显示**：所有时间显示为用户本地时间

#### 4.2 功能增强
- **可收缩侧边栏**：支持键盘快捷键（Ctrl+H）切换
- **搜索功能**：历史记录支持关键词搜索
- **详情查看**：点击历史记录可查看完整对话内容
- **统计信息**：右上角实时显示使用统计

### 第五阶段：部署与配置

#### 5.1 Render平台部署
- **配置文件**：`render.yaml` 配置部署参数
- **构建脚本**：`build.sh` 自动化构建流程
- **环境变量**：配置OPENAI_API_KEY等关键环境变量
- **依赖管理**：确保所有Python包正确安装

#### 5.2 部署优化
- **文件系统适配**：Render只读文件系统适配
- **内存存储**：Token数据使用内存存储而非文件存储
- **错误处理**：完善的错误处理和日志记录
- **健康检查**：`/health` 端点监控服务状态

---

## 🛠️ 技术实现细节

### 后端架构
```python
# 核心组件
- LightRAG: 检索增强生成框架
- Flask: Web应用框架
- OpenAI API: 大语言模型接口
- TokenUsageTracker: Token使用跟踪器
```

### 前端技术
```javascript
// 主要功能
- Canvas绘图: 柱状图可视化
- LocalStorage: 侧边栏状态持久化
- Fetch API: 异步数据请求
- 响应式设计: CSS Grid + Flexbox
```

### 数据流
1. **用户输入** → Flask路由处理
2. **LightRAG查询** → 多模式检索
3. **OpenAI API调用** → 生成回答
4. **Token统计** → 记录使用情况
5. **前端更新** → 实时显示结果

---

## 📊 功能特性总览

### 核心功能
- ✅ 智能问答系统
- ✅ 多模式查询支持
- ✅ 实时评分反馈
- ✅ Token使用统计
- ✅ 成本计算跟踪

### 界面功能
- ✅ 暗黑主题设计
- ✅ 响应式布局
- ✅ 可收缩侧边栏
- ✅ 历史记录管理
- ✅ 数据可视化图表

### 部署特性
- ✅ Render云平台部署
- ✅ 环境变量配置
- ✅ 自动化构建
- ✅ 健康状态监控
- ✅ 错误处理机制

---

## 🎯 项目成果

### 技术成果
1. **完整的RAG系统**：基于LightRAG的利益相关者管理问答系统
2. **现代化Web界面**：专业美观的暗黑主题UI设计
3. **数据可视化**：实时token使用统计和柱状图显示
4. **云平台部署**：成功部署到Render平台，支持公网访问

### 用户体验
1. **直观的操作界面**：清晰的导航和功能分区
2. **实时反馈**：即时的评分和成本信息
3. **历史管理**：完整的对话历史记录和搜索功能
4. **数据透明**：详细的token使用统计和成本分析

### 系统稳定性
1. **错误处理**：完善的异常捕获和处理机制
2. **性能优化**：高效的数据处理和缓存策略
3. **部署稳定**：可靠的云平台部署配置
4. **监控机制**：健康检查和状态监控

---

## 🔮 未来扩展方向

### 功能扩展
- 支持更多文档格式
- 增加用户认证系统
- 实现多用户会话管理
- 添加导出报告功能

### 技术优化
- 优化查询性能
- 增加缓存机制
- 实现更复杂的评分算法
- 支持更多AI模型

### 界面增强
- 添加更多图表类型
- 实现数据导出功能
- 增加个性化设置
- 优化移动端体验

---

## 📝 项目总结

这个Stakeholder Management Chatbot项目成功实现了一个完整的智能问答系统，具备以下特点：

1. **技术先进**：采用最新的RAG技术和OpenAI API
2. **界面美观**：现代化的暗黑主题设计
3. **功能完整**：从基础问答到高级统计功能
4. **部署可靠**：稳定的云平台部署方案
5. **用户体验优秀**：直观的操作界面和实时反馈

项目展示了从需求分析、技术选型、开发实现到部署上线的完整软件开发流程，是一个成功的AI应用开发案例。

---

*文档创建时间：2024年7月*  
*项目状态：已完成并部署到Render平台*  
*技术栈：Python Flask + LightRAG + OpenAI API + Render* 